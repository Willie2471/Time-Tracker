<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WS Lawn Care ‚Äî Time Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'IBM Plex Sans', sans-serif;
    background: #0f1117;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #e8e8e8;
  }

  /* ‚îÄ‚îÄ Demo backdrop ‚îÄ‚îÄ */
  .demo-bg {
    position: fixed; inset: 0;
    background: linear-gradient(135deg, #0f1117 0%, #141a24 50%, #0f1117 100%);
    overflow: hidden;
    z-index: 0;
  }
  .demo-bg::before {
    content: '';
    position: absolute;
    width: 600px; height: 600px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(74,222,128,0.04) 0%, transparent 70%);
    top: 10%; left: 30%;
  }

  /* ‚îÄ‚îÄ Widget ‚îÄ‚îÄ */
  #widget {
    position: relative;
    z-index: 10;
    width: 380px;
    background: #181d27;
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 16px;
    box-shadow: 0 32px 80px rgba(0,0,0,0.6), 0 0 0 1px rgba(74,222,128,0.06);
    overflow: hidden;
    user-select: none;
    cursor: default;
    transition: box-shadow 0.2s;
  }
  #widget:hover {
    box-shadow: 0 36px 90px rgba(0,0,0,0.7), 0 0 0 1px rgba(74,222,128,0.12);
  }

  /* ‚îÄ‚îÄ Header / drag bar ‚îÄ‚îÄ */
  .widget-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 16px 12px;
    background: #1e2535;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    cursor: grab;
  }
  .widget-header:active { cursor: grabbing; }
  .header-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .logo-dot {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: #4ade80;
    box-shadow: 0 0 8px rgba(74,222,128,0.6);
  }
  .logo-text {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.12em;
    color: #4ade80;
    text-transform: uppercase;
  }
  .header-controls {
    display: flex;
    gap: 6px;
  }
  .ctrl-btn {
    width: 26px; height: 26px;
    border: none;
    border-radius: 6px;
    background: rgba(255,255,255,0.06);
    color: #8891a5;
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s, color 0.15s;
  }
  .ctrl-btn:hover { background: rgba(255,255,255,0.12); color: #e8e8e8; }

  /* ‚îÄ‚îÄ Active timer bar ‚îÄ‚îÄ */
  .timer-bar {
    padding: 12px 16px;
    background: rgba(74,222,128,0.06);
    border-bottom: 1px solid rgba(74,222,128,0.1);
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .timer-bar.idle {
    background: rgba(255,255,255,0.03);
    border-bottom-color: rgba(255,255,255,0.06);
  }
  .timer-project-name {
    flex: 1;
    font-size: 13px;
    font-weight: 500;
    color: #e8e8e8;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .timer-project-name.idle-text { color: #4d5568; font-style: italic; }
  .timer-display {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 15px;
    font-weight: 600;
    color: #4ade80;
    min-width: 60px;
    text-align: right;
  }
  .timer-display.idle { color: #4d5568; }
  .play-stop-btn {
    width: 30px; height: 30px;
    border: none;
    border-radius: 8px;
    background: #4ade80;
    color: #0f1117;
    font-size: 11px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.15s, transform 0.1s;
    flex-shrink: 0;
  }
  .play-stop-btn:hover { background: #22c55e; transform: scale(1.05); }
  .play-stop-btn.running { background: #f87171; color: #fff; }
  .play-stop-btn.running:hover { background: #ef4444; }

  /* ‚îÄ‚îÄ Search box ‚îÄ‚îÄ */
  .search-wrap {
    padding: 10px 14px;
    border-bottom: 1px solid rgba(255,255,255,0.06);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .search-icon { color: #4d5568; font-size: 13px; flex-shrink: 0; }
  .search-input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 13px;
    color: #e8e8e8;
    caret-color: #4ade80;
  }
  .search-input::placeholder { color: #4d5568; }

  /* ‚îÄ‚îÄ Project list ‚îÄ‚îÄ */
  .project-list {
    max-height: 220px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.1) transparent;
  }
  .project-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    cursor: pointer;
    border-left: 2px solid transparent;
    transition: background 0.12s, border-color 0.12s;
  }
  .project-item:hover {
    background: rgba(255,255,255,0.04);
    border-left-color: rgba(74,222,128,0.3);
  }
  .project-item.active-project {
    background: rgba(74,222,128,0.08);
    border-left-color: #4ade80;
  }
  .project-icon {
    width: 28px; height: 28px;
    border-radius: 7px;
    background: rgba(255,255,255,0.06);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    flex-shrink: 0;
  }
  .project-item.active-project .project-icon {
    background: rgba(74,222,128,0.15);
  }
  .project-meta { flex: 1; min-width: 0; }
  .project-title {
    font-size: 13px;
    font-weight: 500;
    color: #d1d5db;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .project-item.active-project .project-title { color: #4ade80; }
  .project-sub {
    font-size: 11px;
    color: #4d5568;
    font-family: 'IBM Plex Mono', monospace;
    margin-top: 1px;
  }
  .project-time {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: #6b7280;
    flex-shrink: 0;
  }
  .project-arrow {
    font-size: 10px;
    color: #374151;
    flex-shrink: 0;
  }

  /* ‚îÄ‚îÄ Add project ‚îÄ‚îÄ */
  .add-project-row {
    padding: 8px 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    border-top: 1px solid rgba(255,255,255,0.06);
  }
  .add-input {
    flex: 1;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 7px;
    padding: 6px 10px;
    font-family: 'IBM Plex Sans', sans-serif;
    font-size: 12px;
    color: #e8e8e8;
    outline: none;
    caret-color: #4ade80;
    transition: border-color 0.15s;
  }
  .add-input:focus { border-color: rgba(74,222,128,0.4); }
  .add-input::placeholder { color: #4d5568; }
  .add-btn {
    padding: 6px 12px;
    background: rgba(74,222,128,0.15);
    border: 1px solid rgba(74,222,128,0.25);
    border-radius: 7px;
    color: #4ade80;
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.15s;
  }
  .add-btn:hover { background: rgba(74,222,128,0.25); }

  /* ‚îÄ‚îÄ Filter tabs ‚îÄ‚îÄ */
  .filter-tabs {
    display: flex;
    gap: 4px;
    padding: 10px 14px;
    border-top: 1px solid rgba(255,255,255,0.06);
    background: #161b26;
  }
  .tab {
    flex: 1;
    padding: 5px 0;
    text-align: center;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: #4d5568;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.12s, color 0.12s;
  }
  .tab.active {
    background: rgba(74,222,128,0.12);
    color: #4ade80;
  }
  .tab:hover:not(.active) {
    color: #9ca3af;
    background: rgba(255,255,255,0.04);
  }

  /* ‚îÄ‚îÄ Summary panel ‚îÄ‚îÄ */
  .summary-panel {
    padding: 12px 14px 14px;
    background: #161b26;
    border-top: 1px solid rgba(255,255,255,0.06);
  }
  .summary-header {
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #4d5568;
    margin-bottom: 10px;
  }
  .summary-rows {}
  .summary-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 5px 0;
    border-bottom: 1px solid rgba(255,255,255,0.04);
  }
  .summary-row:last-child { border-bottom: none; }
  .summary-project {
    font-size: 12px;
    color: #9ca3af;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 200px;
  }
  .summary-hrs {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 12px;
    color: #6b7280;
  }
  .summary-total-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 8px;
    margin-top: 4px;
    border-top: 1px solid rgba(74,222,128,0.15);
  }
  .summary-total-label {
    font-size: 11px;
    font-weight: 600;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }
  .summary-total-val {
    font-family: 'IBM Plex Mono', monospace;
    font-size: 14px;
    font-weight: 600;
    color: #4ade80;
  }

  /* ‚îÄ‚îÄ Footer ‚îÄ‚îÄ */
  .widget-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 14px;
    background: #13181f;
    border-top: 1px solid rgba(255,255,255,0.05);
  }
  .footer-label {
    font-size: 10px;
    color: #374151;
    font-family: 'IBM Plex Mono', monospace;
  }
  .export-btn {
    background: none;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 5px;
    padding: 3px 8px;
    font-size: 10px;
    color: #6b7280;
    cursor: pointer;
    font-family: 'IBM Plex Sans', sans-serif;
    transition: border-color 0.15s, color 0.15s;
  }
  .export-btn:hover { border-color: rgba(74,222,128,0.4); color: #4ade80; }

  /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
  #toast {
    position: fixed;
    bottom: 24px; left: 50%;
    transform: translateX(-50%) translateY(60px);
    background: #1e2535;
    border: 1px solid rgba(74,222,128,0.3);
    color: #4ade80;
    font-size: 12px;
    font-family: 'IBM Plex Mono', monospace;
    padding: 8px 16px;
    border-radius: 8px;
    z-index: 99;
    transition: transform 0.25s cubic-bezier(0.34,1.56,0.64,1);
    pointer-events: none;
  }
  #toast.show { transform: translateX(-50%) translateY(0); }

  /* Scrollbar */
  .project-list::-webkit-scrollbar { width: 4px; }
  .project-list::-webkit-scrollbar-track { background: transparent; }
  .project-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 2px; }
</style>
</head>
<body>
<div class="demo-bg"></div>

<div id="widget">

  <!-- Header -->
  <div class="widget-header" id="dragBar">
    <div class="header-left">
      <div class="logo-dot" id="pulseDot"></div>
      <span class="logo-text">WS Time Tracker</span>
    </div>
    <div class="header-controls">
      <button class="ctrl-btn" title="Minimize" onclick="toggleMinimize()">‚îÄ</button>
    </div>
  </div>

  <div id="mainBody">
    <!-- Active timer -->
    <div class="timer-bar idle" id="timerBar">
      <div class="project-icon" id="timerIcon">‚è∏</div>
      <div class="timer-project-name idle-text" id="timerProjectName">No active timer</div>
      <div class="timer-display idle" id="timerDisplay">00:00</div>
      <button class="play-stop-btn" id="playStopBtn" onclick="toggleTimer()">‚ñ∂</button>
    </div>

    <!-- Search -->
    <div class="search-wrap">
      <span class="search-icon">‚åï</span>
      <input class="search-input" id="searchInput" placeholder="Search projects‚Ä¶" oninput="filterProjects()">
    </div>

    <!-- Project list -->
    <div class="project-list" id="projectList"></div>

    <!-- Add project -->
    <div class="add-project-row">
      <input class="add-input" id="newProjectInput" placeholder="New project name‚Ä¶" onkeydown="if(event.key==='Enter')addProject()">
      <button class="add-btn" onclick="addProject()">+ Add</button>
    </div>

    <!-- Filter tabs -->
    <div class="filter-tabs">
      <div class="tab active" onclick="setFilter('day',this)">Day</div>
      <div class="tab" onclick="setFilter('week',this)">Week</div>
      <div class="tab" onclick="setFilter('month',this)">Month</div>
      <div class="tab" onclick="setFilter('year',this)">Year</div>
    </div>

    <!-- Summary -->
    <div class="summary-panel">
      <div class="summary-header" id="summaryHeader">Today's Summary</div>
      <div class="summary-rows" id="summaryRows"></div>
      <div class="summary-total-row">
        <span class="summary-total-label">Total</span>
        <span class="summary-total-val" id="summaryTotal">0h 00m</span>
      </div>
    </div>

    <!-- Footer -->
    <div class="widget-footer">
      <span class="footer-label" id="footerDate"></span>
      <button class="export-btn" onclick="exportCSV()">‚Üì Export CSV</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
// ‚îÄ‚îÄ State ‚îÄ‚îÄ
const STORAGE_KEY = 'ws_time_tracker';
let state = loadState();
let timerInterval = null;
let currentFilter = 'day';
let minimized = false;

function defaultState() {
  return {
    projects: [
      { id: uid(), name: 'Mowing Routes', icon: 'üåø', sessions: [] },
      { id: uid(), name: 'Weed Control', icon: 'üå±', sessions: [] },
      { id: uid(), name: 'Fertilization', icon: 'üíß', sessions: [] },
      { id: uid(), name: 'Customer Follow-ups', icon: 'üìû', sessions: [] },
      { id: uid(), name: 'Admin & Billing', icon: 'üìã', sessions: [] },
    ],
    activeProjectId: null,
    activeStart: null,
  };
}

function loadState() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : defaultState();
  } catch { return defaultState(); }
}
function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}
function uid() { return Math.random().toString(36).slice(2, 10); }

// ‚îÄ‚îÄ Timer ‚îÄ‚îÄ
function toggleTimer() {
  if (state.activeProjectId) {
    stopTimer();
  } else {
    // pick first project if none selected via highlight
    const sel = document.querySelector('.project-item.selected-for-start');
    if (sel) {
      startTimer(sel.dataset.id);
    } else {
      showToast('Select a project first');
    }
  }
}

function startTimer(id) {
  if (state.activeProjectId) stopTimer();
  state.activeProjectId = id;
  state.activeStart = Date.now();
  saveState();
  renderProjects();
  renderTimerBar();
  clearInterval(timerInterval);
  timerInterval = setInterval(tickTimer, 1000);
  startPulse();
}

function stopTimer() {
  if (!state.activeProjectId) return;
  const proj = state.projects.find(p => p.id === state.activeProjectId);
  if (proj && state.activeStart) {
    const elapsed = Math.floor((Date.now() - state.activeStart) / 1000);
    if (elapsed > 0) {
      proj.sessions.push({ start: state.activeStart, end: Date.now(), seconds: elapsed });
    }
  }
  state.activeProjectId = null;
  state.activeStart = null;
  saveState();
  clearInterval(timerInterval);
  renderTimerBar();
  renderProjects();
  renderSummary();
  stopPulse();
}

function tickTimer() {
  const elapsed = Math.floor((Date.now() - state.activeStart) / 1000);
  document.getElementById('timerDisplay').textContent = formatMM(elapsed);
  renderSummary();
}

function formatMM(sec) {
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  const s = sec % 60;
  if (h > 0) return `${h}:${pad(m)}:${pad(s)}`;
  return `${pad(m)}:${pad(s)}`;
}
function formatHM(sec) {
  const h = Math.floor(sec / 3600);
  const m = Math.floor((sec % 3600) / 60);
  return `${h}h ${pad(m)}m`;
}
function pad(n) { return String(n).padStart(2,'0'); }

// ‚îÄ‚îÄ Filter helpers ‚îÄ‚îÄ
function sessionInFilter(sess) {
  const d = new Date(sess.start);
  const now = new Date();
  if (currentFilter === 'day') {
    return d.toDateString() === now.toDateString();
  }
  if (currentFilter === 'week') {
    const weekAgo = new Date(); weekAgo.setDate(now.getDate() - 7);
    return d >= weekAgo;
  }
  if (currentFilter === 'month') {
    return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
  }
  if (currentFilter === 'year') {
    return d.getFullYear() === now.getFullYear();
  }
  return false;
}

function projectSecondsInFilter(proj) {
  let total = proj.sessions.filter(sessionInFilter).reduce((a, s) => a + s.seconds, 0);
  // add live seconds if active
  if (proj.id === state.activeProjectId && state.activeStart) {
    total += Math.floor((Date.now() - state.activeStart) / 1000);
  }
  return total;
}

// ‚îÄ‚îÄ Render ‚îÄ‚îÄ
function renderTimerBar() {
  const bar = document.getElementById('timerBar');
  const nameEl = document.getElementById('timerProjectName');
  const dispEl = document.getElementById('timerDisplay');
  const btn = document.getElementById('playStopBtn');
  const icon = document.getElementById('timerIcon');

  if (state.activeProjectId) {
    const proj = state.projects.find(p => p.id === state.activeProjectId);
    bar.classList.remove('idle');
    nameEl.classList.remove('idle-text');
    nameEl.textContent = proj ? proj.name : 'Unknown';
    icon.textContent = proj ? proj.icon : '‚ñ∂';
    const elapsed = Math.floor((Date.now() - state.activeStart) / 1000);
    dispEl.textContent = formatMM(elapsed);
    dispEl.classList.remove('idle');
    btn.classList.add('running');
    btn.textContent = '‚ñ†';
    btn.title = 'Stop';
  } else {
    bar.classList.add('idle');
    nameEl.classList.add('idle-text');
    nameEl.textContent = 'No active timer';
    icon.textContent = '‚è∏';
    dispEl.textContent = '00:00';
    dispEl.classList.add('idle');
    btn.classList.remove('running');
    btn.textContent = '‚ñ∂';
    btn.title = 'Start';
  }
}

function renderProjects() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const list = document.getElementById('projectList');
  list.innerHTML = '';
  state.projects
    .filter(p => p.name.toLowerCase().includes(query))
    .forEach(proj => {
      const secs = projectSecondsInFilter(proj);
      const isActive = proj.id === state.activeProjectId;
      const div = document.createElement('div');
      div.className = 'project-item' + (isActive ? ' active-project' : '');
      div.dataset.id = proj.id;
      div.innerHTML = `
        <div class="project-icon">${proj.icon}</div>
        <div class="project-meta">
          <div class="project-title">${proj.name}</div>
          <div class="project-sub">${secs > 0 ? formatHM(secs) : '‚Äî'}</div>
        </div>
        <div class="project-time">${formatMM(secs)}</div>
        <div class="project-arrow">‚Ä∫</div>
      `;
      div.addEventListener('click', () => {
        // Remove selected-for-start from others
        document.querySelectorAll('.project-item').forEach(el => el.classList.remove('selected-for-start'));
        if (isActive) {
          stopTimer();
        } else {
          startTimer(proj.id);
        }
      });
      div.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        if (confirm(`Delete project "${proj.name}"?`)) {
          if (state.activeProjectId === proj.id) stopTimer();
          state.projects = state.projects.filter(p => p.id !== proj.id);
          saveState();
          renderAll();
        }
      });
      list.appendChild(div);
    });
}

function renderSummary() {
  const rows = document.getElementById('summaryRows');
  rows.innerHTML = '';
  let total = 0;
  const labels = {day:'Today',week:'This Week',month:'This Month',year:'This Year'};
  document.getElementById('summaryHeader').textContent = `${labels[currentFilter]}'s Summary`;

  state.projects.forEach(proj => {
    const secs = projectSecondsInFilter(proj);
    if (secs === 0) return;
    total += secs;
    const row = document.createElement('div');
    row.className = 'summary-row';
    row.innerHTML = `
      <span class="summary-project">${proj.icon} ${proj.name}</span>
      <span class="summary-hrs">${formatHM(secs)}</span>
    `;
    rows.appendChild(row);
  });

  document.getElementById('summaryTotal').textContent = formatHM(total);
  if (rows.children.length === 0) {
    rows.innerHTML = `<div style="font-size:12px;color:#4d5568;padding:6px 0;">No time logged yet.</div>`;
  }
}

function renderAll() {
  renderTimerBar();
  renderProjects();
  renderSummary();
}

function filterProjects() { renderProjects(); }

function setFilter(f, tab) {
  currentFilter = f;
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  tab.classList.add('active');
  renderSummary();
  renderProjects();
}

function addProject() {
  const input = document.getElementById('newProjectInput');
  const name = input.value.trim();
  if (!name) return;
  const icons = ['üìÅ','üîß','‚úÇÔ∏è','üöú','üåæ','üíº','üìù','üîë','üå≥','‚ö°'];
  const proj = {
    id: uid(),
    name,
    icon: icons[Math.floor(Math.random() * icons.length)],
    sessions: []
  };
  state.projects.push(proj);
  saveState();
  input.value = '';
  renderAll();
  showToast(`Added "${name}"`);
}

function toggleMinimize() {
  const body = document.getElementById('mainBody');
  minimized = !minimized;
  body.style.display = minimized ? 'none' : '';
}

// ‚îÄ‚îÄ Pulse animation ‚îÄ‚îÄ
function startPulse() {
  const dot = document.getElementById('pulseDot');
  dot.style.animation = 'pulse 1.2s ease-in-out infinite';
}
function stopPulse() {
  document.getElementById('pulseDot').style.animation = '';
}

const pulseStyle = document.createElement('style');
pulseStyle.textContent = `@keyframes pulse { 0%,100%{box-shadow:0 0 6px rgba(74,222,128,0.5)} 50%{box-shadow:0 0 14px rgba(74,222,128,0.9)} }`;
document.head.appendChild(pulseStyle);

// ‚îÄ‚îÄ Export CSV ‚îÄ‚îÄ
function exportCSV() {
  let csv = 'Project,Date,Start,End,Duration (min)\n';
  state.projects.forEach(proj => {
    proj.sessions.forEach(sess => {
      const startD = new Date(sess.start);
      const endD = new Date(sess.end);
      csv += `"${proj.name}","${startD.toLocaleDateString()}","${startD.toLocaleTimeString()}","${endD.toLocaleTimeString()}","${Math.round(sess.seconds/60)}"\n`;
    });
  });
  const blob = new Blob([csv], {type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `ws-time-tracker-${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  showToast('CSV exported!');
}

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2200);
}

// ‚îÄ‚îÄ Footer date ‚îÄ‚îÄ
function updateFooterDate() {
  document.getElementById('footerDate').textContent = new Date().toLocaleDateString('en-US', {weekday:'short',month:'short',day:'numeric'});
}

// ‚îÄ‚îÄ Drag ‚îÄ‚îÄ
(function initDrag() {
  const widget = document.getElementById('widget');
  const bar = document.getElementById('dragBar');
  let dragging = false, ox, oy;
  widget.style.position = 'absolute';
  bar.addEventListener('mousedown', e => {
    dragging = true;
    ox = e.clientX - widget.offsetLeft;
    oy = e.clientY - widget.offsetTop;
  });
  document.addEventListener('mousemove', e => {
    if (!dragging) return;
    widget.style.left = (e.clientX - ox) + 'px';
    widget.style.top = (e.clientY - oy) + 'px';
  });
  document.addEventListener('mouseup', () => dragging = false);
})();

// ‚îÄ‚îÄ Boot ‚îÄ‚îÄ
updateFooterDate();
renderAll();
if (state.activeProjectId && state.activeStart) {
  timerInterval = setInterval(tickTimer, 1000);
  startPulse();
}
setInterval(renderSummary, 5000);
</script>
</body>
</html>
